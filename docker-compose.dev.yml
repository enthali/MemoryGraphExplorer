# Development docker-compose: Consolidated single container
# Runs both MCP Server and Web UI in one container for simplified deployment

name: memorygraphexplorer-dev

services:
  memory-graph-explorer-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: memory-graph-explorer-dev
    ports:
      - "8081:8080"  # Development: Web UI on host port 8081 (MCP internal on 3000)
    volumes:
      # Mount entire data directory
      # NOTE: Using Windows host path for Docker Desktop compatibility
      # TODO: Make this configurable for Codespaces/Azure deployment
      - C:/workspace/web_Projects/MemoryGraphExplorer/data:/app/data
    environment:
      - NODE_ENV=development
      - FLASK_ENV=development
      - MEMORY_FILE_PATH=/app/data/memory-test.json
      - MCP_SERVER_PORT=3000
      - WEB_UI_PORT=8080
      - MCP_SERVER_URL=http://localhost:3000/mcp
      - MCP_PROXY_INTERNAL_URL=http://localhost:3000/mcp
      - AUTH_ENABLED=false
      # - API_KEYS=dev-key-123:Developer:read,write|admin-key-456:Admin:read,write,admin
    restart: unless-stopped
    healthcheck:
      # Health check disabled when AUTH_ENABLED=false (dev mode)
      # For production with auth, use: curl -H "X-API-Key: your-key" http://localhost:8080/api/health
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

